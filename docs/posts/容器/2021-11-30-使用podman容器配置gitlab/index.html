<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="referrer" content="no-referrer">

    <title>使用podman容器配置gitlab | Witton的博客</title>
    <meta property="og:title" content="使用podman容器配置gitlab - Witton的博客">
    <meta property="og:type" content="article">
    <meta property="article:published_time" content='2021-11-30T00:00:00&#43;08:00'>
    <meta property="article:modified_time" content='2021-11-30T00:00:00&#43;08:00'>
    <meta name="Keywords" content="C,C&#43;&#43;,golang,go,erlang,python,C#,VS,Visual Studio,C/C&#43;&#43;,lua,博客,项目管理,软件架构">
    <meta name="description" content="使用podman容器配置gitlab">
    <meta name="author" content="Witton Bell">
    <meta property="og:url" content="https://wittonbell.github.io/posts/%E5%AE%B9%E5%99%A8/2021-11-30-%E4%BD%BF%E7%94%A8podman%E5%AE%B9%E5%99%A8%E9%85%8D%E7%BD%AEgitlab/">
    <link rel="shortcut icon" href='/favicon.ico' type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    <link rel="stylesheet" href='/css/post-nav.css'><script type="text/javascript" src="//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <link href="https://cdn.bootcdn.net/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/katex@0.16.8/dist/katex.min.css"
    integrity="sha384-GvrOXuhMATgEsSwCs4smul74iXGOixntILdUW9XmUC6+HX0sLNAK3q71HotJqlAn" crossorigin="anonymous">
<script defer src="https://unpkg.com/katex@0.16.8/dist/katex.min.js"
    integrity="sha384-cpW21h6RZv/phavutF+AuVYrr+dA8xD9zs6FwLpaCct6O9ctzYFfFr4dgmgccOTx"
    crossorigin="anonymous"></script>
<script defer src="https://unpkg.com/katex@0.16.8/dist/contrib/auto-render.min.js"
    integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05"
    crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/mhchem.min.js"
    integrity="sha384-ifpG+NlgMq0kvOSGqGQxW1mJKpjjMDmZdpKGq3tbvD3WPhyshCEEYClriK/wRVU0"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/copy-tex.min.js"
    integrity="sha384-ww/583aHhxWkz5DEVn6OKtNiIaLi2iBRNZXfJRiY1Ai7tnJ9UXpEsyvOITVpTl4A"
    crossorigin="anonymous"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        renderMathInElement(document.body, {
            
            
            delimiters: [
                { left: '$$', right: '$$', display: true },
                { left: '$', right: '$', display: false },
                { left: '\\(', right: '\\)', display: false },
                { left: '\\[', right: '\\]', display: true }
            ],
            
            throwOnError: false
        });
    });
</script>
    
    </head>

<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                    <a id="logo" href="https://wittonbell.github.io/">
                        Witton的博客
                    </a>
                <p class="description">游戏服务器开发、C/C&#43;&#43;、Go、Python，博客</p>
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="current" href="https://wittonbell.github.io/" title="首页">首页</a>
                    <a  href="https://wittonbell.github.io/archives/" title="归档">归档</a>
                    <a  href="https://wittonbell.github.io/tags/" title="标签">标签</a>
                    <a  href="https://wittonbell.github.io/about/" title="关于">关于</a>
                </nav>
            </div>
        </div>
    </div>
</header>
<div id="body">
        <div class="container">
            <div class="col-group">
                <div class="col-8" id="main">
                    <div class="res-cons">

<style type="text/css">
    .post-toc {
        position: fixed;
        width: 300px;
        margin-left: -310px;
        padding: 5px 10px;
        font-family: Athelas, STHeiti, Microsoft Yahei, serif;
        font-size: 12px;
        border: 1px solid rgba(0, 0, 0, .07);
        border-radius: 5px;
        background-color: rgba(255, 255, 255, 0.98);
        background-clip: padding-box;
        -webkit-box-shadow: 1px 1px 2px rgba(0, 0, 0, .125);
        box-shadow: 1px 1px 2px rgba(0, 0, 0, .125);
        word-wrap: break-word;
        white-space: nowrap;
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
        z-index: 999;
        cursor: pointer;
        max-height: 70%;
        overflow-y: auto;
        overflow-x: hidden;
    }

    .post-toc .post-toc-title {
        width: 100%;
        margin: 0 auto;
        font-size: 20px;
        font-weight: 400;
        text-transform: uppercase;
        text-align: center;
    }

    .post-toc .post-toc-content {
        font-size: 15px;
    }

    .post-toc .post-toc-content>nav>ul {
        margin: 1px 0;
        list-style:none;
    }

    .post-toc .post-toc-content ul {
        padding-left: 1px;
        list-style: square;
        margin: 0.5em;
        line-height: 1.8em;
        list-style:none;
    }

    .post-toc .post-toc-content ul ul {
        padding-left: 15px;
    }

    @media print,
    screen and (max-width:1057px) {
        .post-toc {
            display: none;
        }
    }
</style>

<div class="post-toc" style="position: absolute; top: 188px;">
    <h2 class="post-toc-title">文章目录</h2>
    <div class="post-toc-content">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#一下载gitlab以及gitlab-runner镜像">一、下载gitlab以及gitlab-runner镜像</a></li>
    <li><a href="#二运行容器与配置gitlab">二、运行容器与配置gitlab</a>
      <ul>
        <li><a href="#1运行gitlab容器">1、运行gitlab容器</a></li>
        <li><a href="#2修改配置">2、修改配置</a></li>
        <li><a href="#3登录gitlab">3、登录gitlab</a></li>
      </ul>
    </li>
    <li><a href="#三运行与注册gitlab-runner">三、运行与注册gitlab-runner</a>
      <ul>
        <li><a href="#1运行gitlab-runner">1、运行gitlab-runner</a></li>
        <li><a href="#2进入容器bash">2、进入容器Bash</a></li>
        <li><a href="#3注册gitlab-runner">3、注册gitlab-runner</a>
          <ul>
            <li><a href="#a注册shell">a、注册shell</a></li>
            <li><a href="#b注册docker">b、注册docker</a></li>
          </ul>
        </li>
        <li><a href="#4安装相应的软件">4、安装相应的软件</a></li>
      </ul>
    </li>
    <li><a href="#四测试">四、测试</a>
      <ul>
        <li><a href="#1测试shell">1、测试Shell</a>
          <ul>
            <li><a href="#a准备项目">A、准备项目</a></li>
            <li><a href="#b测试容器镜像库">B、测试容器镜像库</a></li>
          </ul>
        </li>
        <li><a href="#2测试docker">2、测试docker</a>
          <ul>
            <li><a href="#a准备环境-1">A、准备环境</a></li>
            <li><a href="#b准备项目">B、准备项目</a></li>
            <li><a href="#c测试">C、测试</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

<script type="text/javascript">
    $(document).ready(function () {
        var postToc = $(".post-toc");
        if (postToc.length) {
            var leftPos = $("#main").offset().left;
            if (leftPos < 220) {
                postToc.css({ "width": leftPos - 10, "margin-left": (0 - leftPos) })
            }

            var t = postToc.offset().top - 20,
                a = {
                    start: {
                        position: "absolute",
                        top: t
                    },
                    process: {
                        position: "fixed",
                        top: 20
                    },
                };
            $(window).scroll(function () {
                var e = $(window).scrollTop();
                e < t ? postToc.css(a.start) : postToc.css(a.process)
            })
        }

        if ($("#TableOfContents").children().length < 1) {
            $(".post-toc").remove();
        }
    })
</script>

<article class="post">
        <header>
            <h1 class="post-title">使用podman容器配置gitlab</h1>
        </header>
        <time datetime="2021-11-30T00:00:00Z" class="post-meta meta-date dt-published">2021年11月30日</time>
<span class="post-meta meta-category">&nbsp;|&nbsp; 作者: Witton Bell</span>
<div class="post-meta meta-category">
  <span>&nbsp;|&nbsp;</span><a href="/categories/%E5%AE%B9%E5%99%A8/" class="category-link p-category" target="_blank">容器</a>/<a href="/categories/Go/" class="category-link p-category" target="_blank">Go</a>/<a href="/categories/Linux/" class="category-link p-category" target="_blank">Linux</a>
</div>
<span class="post-meta meta-category">&nbsp;|&nbsp; 4352 字</span>
<span class="post-meta meta-category">&nbsp;|&nbsp; 9&nbsp;分钟</span>

        <div class="post-meta">
            <span id="busuanzi_container_page_pv">&nbsp;|
                <span id="busuanzi_value_page_pv"></span> <span>阅读</span>
            </span>
        </div>
        <div class="post-content">
            <h1 id="一下载gitlab以及gitlab-runner镜像">一、下载gitlab以及gitlab-runner镜像</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>sudo podman pull docker.io/gitlab/gitlab-ee
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>sudo podman pull docker.io/gitlab/gitlab-runner
</span></span></code></pre></div><p>笔者下载的版本是gitlab-ee 14.5，gitlab-runner 14.5</p>
<h1 id="二运行容器与配置gitlab">二、运行容器与配置gitlab</h1>
<h2 id="1运行gitlab容器">1、运行gitlab容器</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span>sudo podman run -dt <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span><span style="color:#ae81ff"></span>  --h <span style="color:#e6db74">&#34;192.168.1.8&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span><span style="color:#ae81ff"></span>  -p 443:443 -p 80:80 -p 22:22 -p 5050:5050 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span><span style="color:#ae81ff"></span>  --name gitlab <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span><span style="color:#ae81ff"></span>  --restart always <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span><span style="color:#ae81ff"></span>  -v /home/gitlab/etc:/etc/gitlab <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span><span style="color:#ae81ff"></span>  -v /home/gitlab/logs:/var/log/gitlab <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span><span style="color:#ae81ff"></span>  -v /home/gitlab/git-data:/var/opt/gitlab/git-data <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span><span style="color:#ae81ff"></span>  -v /home/gitlab/backups:/var/opt/gitlab/backups <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span><span style="color:#ae81ff"></span>  -v /home/gitlab/opt:/var/opt/gitlab <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span><span style="color:#ae81ff"></span>  docker.io/gitlab/gitlab-ee
</span></span></code></pre></div><ul>
<li>-d：后台运行</li>
<li>-t：分配伪终端</li>
<li>-h：指定主机名</li>
<li>-p：映射主机与容器端口，冒号前面为主机端口，后面为容器端口</li>
<li>&ndash;name：指定名字</li>
<li>-v：映射主机与容器的目录，冒号前面为主机目录，后面为容器目录
这里映射了gitlab的配置、日志、以及数据。要求在映射时主机存在相应的目录。</li>
</ul>
<h2 id="2修改配置">2、修改配置</h2>
<p>笔者不作任何配置修改的情况下，运行gitlab会一直报错：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>caller<span style="color:#f92672">=</span>cluster.go:154 component<span style="color:#f92672">=</span>cluster err<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;couldn&#39;t deduce an advertise address: no private IP found, explicit advertise addr not provided&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>caller<span style="color:#f92672">=</span>main.go:241 msg<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;unable to initialize gossip mesh&#34;</span> err<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;create memberlist: Failed to get final advertise address: No private IP address found, and explicit IP not provided&#34;</span>
</span></span></code></pre></div><p>使用如下命令进入容器Bash：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>sudo podman exec -it gitlab bash
</span></span></code></pre></div><p>然后修改/etc/gitlab/gitlab.rb文件（如果在创建容器时有将配置文件所在目录映射到主机，则可以直接在主机修改），添加如下配置：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>alertmanager<span style="color:#f92672">[</span><span style="color:#e6db74">&#39;flags&#39;</span><span style="color:#f92672">]</span> <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>  <span style="color:#e6db74">&#39;cluster.advertise-address&#39;</span> <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#34;0.0.0.0:9093&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>即可解决不断报错的问题。</p>
<p>添加如下配置，设置时区为上海时区</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>gitlab_rails<span style="color:#f92672">[</span><span style="color:#e6db74">&#39;time_zone&#39;</span><span style="color:#f92672">]</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Asia/Shanghai&#39;</span>
</span></span></code></pre></div><p>如果想开启Gitlab自带的容器镜像库，添加如下配置：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>registry_external_url <span style="color:#e6db74">&#39;https://localhost:5050&#39;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>gitlab_rails<span style="color:#f92672">[</span><span style="color:#e6db74">&#39;registry_enabled&#39;</span><span style="color:#f92672">]</span> <span style="color:#f92672">=</span> true
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>registry_nginx<span style="color:#f92672">[</span><span style="color:#e6db74">&#39;ssl_certificate_key&#39;</span><span style="color:#f92672">]</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;/var/opt/gitlab/gitlab-rails/etc/gitlab-registry.key&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span>registry_nginx<span style="color:#f92672">[</span><span style="color:#e6db74">&#39;ssl_certificate&#39;</span><span style="color:#f92672">]</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;/var/opt/gitlab/registry/gitlab-registry.crt&#34;</span>
</span></span></code></pre></div><p><strong>需要注意的是证书及密钥的存储位置（笔者下载的Gitlab容器启用容器镜像库后，默认就是上面的位置），如果上面的目录中没有相应的文件，则需要修改为相应的位置</strong>。</p>
<p>每次修改了gitlab.rb文件后，都需要<strong>在主机使用如下命令</strong>让配置生效：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>sudo podman exec -it gitlab gitlab-ctl reconfigure
</span></span></code></pre></div><h2 id="3登录gitlab">3、登录gitlab</h2>
<p>在配置好gitlab并运行后，就可以使用root账号进行登录了，root账号的密码在：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>/etc/gitlab/initial_root_password
</span></span></code></pre></div><p>文件中。
<strong>注意：此文件将在第一次运行reconfigure后24小时删除，所以安装好后，需要尽快登录gitlab并设置密码。</strong></p>
<h1 id="三运行与注册gitlab-runner">三、运行与注册gitlab-runner</h1>
<h2 id="1运行gitlab-runner">1、运行gitlab-runner</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>sudo podman run -dt --name gitlab-runner --restart always -v /home/gitlab-runner:/etc/gitlab-runner -v /var/run/docker.sock:/var/run/docker.sock docker.io/gitlab/gitlab-runner
</span></span></code></pre></div><p>
        <a data-fancybox="gallery" href="https://img-blog.csdnimg.cn/c638342105e64012a73e6d9d1fdf6df9.png">
            <img class="mx-auto" alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/c638342105e64012a73e6d9d1fdf6df9.png" />
        </a>
    </p>
<p>由于gitlab-runner默认使用的用户为gitlab-runner，如上图所示，而/home/gitlab-runner默认是root用户才有相应的权限，为了顺利执行，笔者建议使用root用户执行，这样就不用手动修改/home/gitlab-runner的权限：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>sudo podman run -dt --name gitlab-runner --restart always -v /home/gitlab-runner:/etc/gitlab-runner -v /var/run/docker.sock:/var/run/docker.sock docker.io/gitlab/gitlab-runner run --working-directory<span style="color:#f92672">=</span>/home/gitlab-runner
</span></span></code></pre></div><p><strong>注意：为了让gitlab-runner能够使用docker命令，在创建容器时必须将/var/run/docker.sock映射到容器，否则会执行失败。</strong></p>
<h2 id="2进入容器bash">2、进入容器Bash</h2>
<p>使用下面的命令进入容器bash：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>sudo podman exec -it gitlab-runner bash
</span></span></code></pre></div><h2 id="3注册gitlab-runner">3、注册gitlab-runner</h2>
<h3 id="a注册shell">a、注册shell</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span>root@7350bbb38bc1:/# gitlab-runner register
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span>Runtime platform                                    arch<span style="color:#f92672">=</span>amd64 os<span style="color:#f92672">=</span>linux pid<span style="color:#f92672">=</span><span style="color:#ae81ff">84</span> revision<span style="color:#f92672">=</span>f0a95a76 version<span style="color:#f92672">=</span>14.5.0
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span>Running in system-mode.                            
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span>                                                   
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>Enter the GitLab instance URL <span style="color:#f92672">(</span><span style="color:#66d9ef">for</span> example, https://gitlab.com/<span style="color:#f92672">)</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>http://192.168.1.8/          <span style="color:#75715e">### 这里填写GitLab实例的URL地址</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>Enter the registration token:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>WWgCAuScx5XGxEVS3Hza         <span style="color:#75715e">### 这里填写GitLab实例中的注册令牌，按下图所示的步骤获取令牌</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>Enter a description <span style="color:#66d9ef">for</span> the runner:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span><span style="color:#f92672">[</span>293e39980f0f<span style="color:#f92672">]</span>: default      <span style="color:#75715e">### 这里填写描述信息 </span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span>Enter tags <span style="color:#66d9ef">for</span> the runner <span style="color:#f92672">(</span>comma-separated<span style="color:#f92672">)</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span>build						 <span style="color:#75715e">### 这里填写标签信息，需要注意的是这个标签在.gitlab-ci.yml中会用到</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span>Registering runner... succeeded                     runner<span style="color:#f92672">=</span>CWgCAuSc
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span>Enter an executor: docker, shell, virtualbox, docker+machine, docker-ssh+machine, kubernetes, custom, parallels, ssh, docker-ssh:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span>shell                      <span style="color:#75715e">### 这里选择执行器，根据自己情况进行选择</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span><span>Runner registered successfully. Feel free to start it, but <span style="color:#66d9ef">if</span> it<span style="color:#960050;background-color:#1e0010">&#39;</span>s running already the config should be automatically reloaded! 
</span></span></code></pre></div><p>
        <a data-fancybox="gallery" href="https://img-blog.csdnimg.cn/9cfb057370324704a33c147db762df84.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAd2l0dG9u,size_20,color_FFFFFF,t_70,g_se,x_16">
            <img class="mx-auto" alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/9cfb057370324704a33c147db762df84.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAd2l0dG9u,size_20,color_FFFFFF,t_70,g_se,x_16" />
        </a>
    </p>
<p>注册成功后，即可在gitlab中看到runner了

        <a data-fancybox="gallery" href="https://img-blog.csdnimg.cn/c111b2a9dbab415489dd2fa305d717a5.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAd2l0dG9u,size_20,color_FFFFFF,t_70,g_se,x_16">
            <img class="mx-auto" alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/c111b2a9dbab415489dd2fa305d717a5.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAd2l0dG9u,size_20,color_FFFFFF,t_70,g_se,x_16" />
        </a>
    </p>
<h3 id="b注册docker">b、注册docker</h3>
<p>如果想要在CI/CD时使用docker来进行打包发布，可以注册docker：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span>root@7350bbb38bc1:/# gitlab-runner register
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span>Runtime platform                                    arch<span style="color:#f92672">=</span>amd64 os<span style="color:#f92672">=</span>linux pid<span style="color:#f92672">=</span><span style="color:#ae81ff">84</span> revision<span style="color:#f92672">=</span>f0a95a76 version<span style="color:#f92672">=</span>14.5.0
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span>Running in system-mode.                            
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span>                                                   
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>Enter the GitLab instance URL <span style="color:#f92672">(</span><span style="color:#66d9ef">for</span> example, https://gitlab.com/<span style="color:#f92672">)</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>http://192.168.1.8/          <span style="color:#75715e">### 这里填写GitLab实例的URL地址</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>Enter the registration token:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>WWgCAuScx5XGxEVS3Hza         <span style="color:#75715e">### 这里填写GitLab实例中的注册令牌，按下图所示的步骤获取令牌</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>Enter a description <span style="color:#66d9ef">for</span> the runner:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span><span style="color:#f92672">[</span>293e39980f0f<span style="color:#f92672">]</span>: master      <span style="color:#75715e">### 这里填写描述信息 </span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span>Enter tags <span style="color:#66d9ef">for</span> the runner <span style="color:#f92672">(</span>comma-separated<span style="color:#f92672">)</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span>docker						 <span style="color:#75715e">### 这里填写标签信息，需要注意的是这个标签在.gitlab-ci.yml中会用到</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span>Registering runner... succeeded                     runner<span style="color:#f92672">=</span>CWgCAuSc
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span>Enter an executor: docker, shell, virtualbox, docker+machine, docker-ssh+machine, kubernetes, custom, parallels, ssh, docker-ssh:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span>docker                      <span style="color:#75715e">### 这里选择执行器，输入docker</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span><span>Enter the default Docker image <span style="color:#f92672">(</span><span style="color:#66d9ef">for</span> example, ruby:2.6<span style="color:#f92672">)</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span><span>docker:latest               <span style="color:#75715e">## 输入docker使用的镜像</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span><span>Runner registered successfully. Feel free to start it, but <span style="color:#66d9ef">if</span> it<span style="color:#960050;background-color:#1e0010">&#39;</span>s running already the config should be automatically reloaded! 
</span></span></code></pre></div><p>docker镜像也可以使用构建在自己的镜像仓库中的镜像。</p>
<p>如果想要修改现有的gitlab-runner，可以在gitlab-runner容器中编辑/etc/gitlab-runner/config.toml</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span>concurrent <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span>check_interval <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span><span style="color:#f92672">[</span>session_server<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>  session_timeout <span style="color:#f92672">=</span> <span style="color:#ae81ff">1800</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span><span style="color:#f92672">[[</span>runners<span style="color:#f92672">]]</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>  name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;master&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>  url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;http://192.168.1.8/&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>  token <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;H7UaNzLUwSSx8sNVmrQH&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span>  executor <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;shell&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span>  <span style="color:#f92672">[</span>runners.custom_build_dir<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span>  <span style="color:#f92672">[</span>runners.cache<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span>    <span style="color:#f92672">[</span>runners.cache.s3<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span>    <span style="color:#f92672">[</span>runners.cache.gcs<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span><span>    <span style="color:#f92672">[</span>runners.cache.azure<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span><span><span style="color:#f92672">[[</span>runners<span style="color:#f92672">]]</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span><span>  name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;master&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span><span>  url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;http://192.168.1.8/&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span><span>  token <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;hCNqcgJQ8jbNCnkrsP_R&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span><span>  executor <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;docker&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span><span>  <span style="color:#f92672">[</span>runners.custom_build_dir<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span><span>  <span style="color:#f92672">[</span>runners.cache<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span><span>    <span style="color:#f92672">[</span>runners.cache.s3<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span><span>    <span style="color:#f92672">[</span>runners.cache.gcs<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27</span><span>    <span style="color:#f92672">[</span>runners.cache.azure<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28</span><span>  <span style="color:#f92672">[</span>runners.docker<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29</span><span>    tls_verify <span style="color:#f92672">=</span> false
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30</span><span>    image <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;docker&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31</span><span>    privileged <span style="color:#f92672">=</span> false
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32</span><span>    disable_entrypoint_overwrite <span style="color:#f92672">=</span> false
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33</span><span>    oom_kill_disable <span style="color:#f92672">=</span> false
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34</span><span>    disable_cache <span style="color:#f92672">=</span> false
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35</span><span>    volumes <span style="color:#f92672">=</span> <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;/cache&#34;</span>,<span style="color:#e6db74">&#34;/var/run/docker.sock:/var/run/docker.sock&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36</span><span>    shm_size <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37</span><span>    pull_policy <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;if-not-present&#34;</span>
</span></span></code></pre></div><p>gitlab-runner注册docker时需要填写一个镜像名称，在.gitlab-ci.yml配置文件中有一个image关键字也可以指定镜像名，这两个有什么关系呢？</p>
<p>这两个镜像都是用于运行.gitlab-ci.yml配置文件中的脚本命令，如果.gitlab-ci.yml中没有指定image，则默认使用gitlab-runner注册docker时使用的镜像，否则使用.gitlab-ci.yml中指定image镜像。</p>
<p>在使用docker时，为了避免每次都从网络上拉取，可以设置</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>pull_policy <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;if-not-present&#34;</span>
</span></span></code></pre></div><p>这样配置后，如果本地有镜像则直接使用本地镜像。</p>
<h2 id="4安装相应的软件">4、安装相应的软件</h2>
<p>由于gitlab-runner是使用的ubuntu系统制作而成，在安装软件前，需要执行一次更新：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>apt update
</span></span></code></pre></div><p>否则在安装软件时可能报错：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>E: Unable to locate package
</span></span></code></pre></div><p>更新后，就可以按自己需要安装相应的软件了，比如笔者需要C++相应的编译环境，安装：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>apt install cmake
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>apt install g++
</span></span></code></pre></div><p>在安装cmake时会额外安装一些包，比如gcc等等，但是不会安装g++包，所以需要单独安装g++：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span>root@7350bbb38bc1:~# apt install cmake
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span>Reading package lists... Done
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span>Building dependency tree       
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span>Reading state information... Done
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>The following additional packages will be installed:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>  binutils binutils-common binutils-x86-64-linux-gnu cmake-data cpp cpp-9 gcc gcc-9 gcc-9-base libarchive13 libasan5 libatomic1 libbinutils libc-dev-bin libc6-dev libcc1-0 libcrypt-dev libctf-nobfd0 libctf0 libgcc-9-dev libgomp1
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>  libicu66 libisl22 libitm1 libjsoncpp1 liblsan0 libmpc3 libmpfr6 libquadmath0 librhash0 libtsan0 libubsan1 libuv1 libxml2 linux-libc-dev make manpages manpages-dev
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>Suggested packages:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>  binutils-doc cmake-doc ninja-build cpp-doc gcc-9-locales gcc-multilib autoconf automake libtool flex bison gdb gcc-doc gcc-9-multilib gcc-9-doc lrzip glibc-doc make-doc man-browser
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>The following NEW packages will be installed:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span>  binutils binutils-common binutils-x86-64-linux-gnu cmake cmake-data cpp cpp-9 gcc gcc-9 gcc-9-base libarchive13 libasan5 libatomic1 libbinutils libc-dev-bin libc6-dev libcc1-0 libcrypt-dev libctf-nobfd0 libctf0 libgcc-9-dev
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span>  libgomp1 libicu66 libisl22 libitm1 libjsoncpp1 liblsan0 libmpc3 libmpfr6 libquadmath0 librhash0 libtsan0 libubsan1 libuv1 libxml2 linux-libc-dev make manpages manpages-dev
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span><span style="color:#ae81ff">0</span> upgraded, <span style="color:#ae81ff">39</span> newly installed, <span style="color:#ae81ff">0</span> to remove and <span style="color:#ae81ff">1</span> not upgraded.
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span>Need to get 48.4 MB of archives.
</span></span></code></pre></div><h1 id="四测试">四、测试</h1>
<h2 id="1测试shell">1、测试Shell</h2>
<h3 id="a准备项目">A、准备项目</h3>
<p>新建一个demo项目，这个项目中有如下三个文件：</p>
<p>
        <a data-fancybox="gallery" href="https://img-blog.csdnimg.cn/c17df80e3d784b3ca5141653f17e613c.png">
            <img class="mx-auto" alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/c17df80e3d784b3ca5141653f17e613c.png" />
        </a>
    </p>
<p>编写一个.gitlab-ci.yml文件，内容如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span><span style="color:#f92672">stages</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span>    - <span style="color:#ae81ff">build</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span><span style="color:#f92672">build</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>    <span style="color:#f92672">stage</span>: <span style="color:#ae81ff">build</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>    <span style="color:#f92672">script</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>    - <span style="color:#ae81ff">rm build -rf</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>    - <span style="color:#ae81ff">mkdir -p build</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>    - <span style="color:#ae81ff">cd build</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>    - <span style="color:#ae81ff">cmake .. -DCMAKE_C_COMPILER=gcc -DCMAKE_CXX_COMPILER=g++</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span>    - <span style="color:#ae81ff">time make -j4</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span>    <span style="color:#f92672">tags</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span>    - <span style="color:#ae81ff">build</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span>    <span style="color:#f92672">only</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span>        <span style="color:#f92672">changes</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span><span>           - <span style="color:#e6db74">&#34;**/*.{c,cpp,cc,h,hpp,cxx,C}&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span><span>           - <span style="color:#e6db74">&#34;**/CMakeLists.txt&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span><span>           - <span style="color:#e6db74">&#34;CMakeLists.txt&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span><span>           - <span style="color:#e6db74">&#34;*.{c,cpp,cc,h,hpp,cxx,C}&#34;</span>
</span></span></code></pre></div><p>其中的tags就是前面注册gitlab-runner使用的标签</p>
<p>CMakeLists.txt文件内容如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span><span style="color:#a6e22e">cmake_minimum_required</span>(VERSION <span style="color:#ae81ff">3.0.0</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span><span style="color:#a6e22e">project</span>(demo VERSION <span style="color:#ae81ff">0.1.0</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span><span style="color:#a6e22e">include</span>(CTest)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span><span style="color:#a6e22e">enable_testing</span>()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span><span style="color:#a6e22e">add_executable</span>(demo main.cpp)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span><span style="color:#a6e22e">set</span>(CPACK_PROJECT_NAME <span style="color:#960050;background-color:#1e0010">$</span>{PROJECT_NAME})
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span><span style="color:#a6e22e">set</span>(CPACK_PROJECT_VERSION <span style="color:#960050;background-color:#1e0010">$</span>{PROJECT_VERSION})
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span><span style="color:#a6e22e">include</span>(CPack)
</span></span></code></pre></div><p>main.cpp文件内容如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;iostream&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span><span style="color:#66d9ef">using</span> <span style="color:#66d9ef">namespace</span> std;
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span>, <span style="color:#66d9ef">char</span><span style="color:#f92672">**</span>) {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>	cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Hello, world!</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>	printf(<span style="color:#e6db74">&#34;测试</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>	<span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>}
</span></span></code></pre></div><p>上传到gitlab后，会自动触发编译项目，如下图所示：</p>
<p>
        <a data-fancybox="gallery" href="https://img-blog.csdnimg.cn/06259ded44e44c4db83e1ab0f3204231.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAd2l0dG9u,size_20,color_FFFFFF,t_70,g_se,x_16">
            <img class="mx-auto" alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/06259ded44e44c4db83e1ab0f3204231.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAd2l0dG9u,size_20,color_FFFFFF,t_70,g_se,x_16" />
        </a>
    </p>
<h3 id="b测试容器镜像库">B、测试容器镜像库</h3>
<p>在前面配置gitlab时有提到，可以启用Gitlab自带容器镜像库，当然也可以配置成外部的容器镜像库，不过配置要复杂些。前面的配置是使用的自带的容器镜像库，启用成功后可以在项目中看到如下图所示功能：</p>
<p>
        <a data-fancybox="gallery" href="https://img-blog.csdnimg.cn/f8b506e5ede240d8ab3b0c050f5c9827.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAd2l0dG9u,size_17,color_FFFFFF,t_70,g_se,x_16">
            <img class="mx-auto" alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/f8b506e5ede240d8ab3b0c050f5c9827.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAd2l0dG9u,size_17,color_FFFFFF,t_70,g_se,x_16" />
        </a>
    </p>
<p>
        <a data-fancybox="gallery" href="https://img-blog.csdnimg.cn/41a83c8940d7453cb6e24d763ca4a9bc.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAd2l0dG9u,size_20,color_FFFFFF,t_70,g_se,x_16">
            <img class="mx-auto" alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/41a83c8940d7453cb6e24d763ca4a9bc.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAd2l0dG9u,size_20,color_FFFFFF,t_70,g_se,x_16" />
        </a>
    </p>
<p>从图中提示可以看出，要使用容器镜像库，还需要先登录，再构建容器镜像，最后推送到容器镜像库，才能显示到页面上。
<strong>需要注意的是，这里配置的容器镜像库由于是使用的localhost，所以只能供主机或者容器使用</strong></p>
<p>根据页面提示的命令，来进行测试：</p>
<h4 id="a准备环境">a、准备环境</h4>
<p>在主机上新建一个目录，比如mon，创建一个Dockfile文件，内容如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>from ubuntu
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>Run echo <span style="color:#e6db74">&#34;这是一个podman测试&#34;</span>
</span></span></code></pre></div><h4 id="b登录">b、登录</h4>
<p>使用下面的命令登录：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>sudo docker login localhost:5050
</span></span></code></pre></div><p>
        <a data-fancybox="gallery" href="https://img-blog.csdnimg.cn/4649df5a286448f19d7f60896941d2c6.png">
            <img class="mx-auto" alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/4649df5a286448f19d7f60896941d2c6.png" />
        </a>
    
登录时需要输入用户名与密码，要求与Gitlab中的用户名密码一致。</p>
<h4 id="c构建容器镜像">c、构建容器镜像</h4>
<p>
        <a data-fancybox="gallery" href="https://img-blog.csdnimg.cn/ea53a3844f33477aabc5a3b5f6fd4b23.png">
            <img class="mx-auto" alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/ea53a3844f33477aabc5a3b5f6fd4b23.png" />
        </a>
    </p>
<h4 id="d推送">d、推送</h4>
<p>
        <a data-fancybox="gallery" href="https://img-blog.csdnimg.cn/7ace33a9100147079de1745e2674ee75.png">
            <img class="mx-auto" alt="docker push localhost:5050/gitlab-instance-fbb7733d/monitoring" src="https://img-blog.csdnimg.cn/7ace33a9100147079de1745e2674ee75.png" />
        </a>
    </p>
<h4 id="e刷新gitlab容器镜像库页面">e、刷新gitlab容器镜像库页面</h4>
<p>推送成功后刷新页面即可看到镜像库列表了，如下图所示：

        <a data-fancybox="gallery" href="https://img-blog.csdnimg.cn/25645acfde5841c1ab498a665aa6f9a0.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAd2l0dG9u,size_20,color_FFFFFF,t_70,g_se,x_16">
            <img class="mx-auto" alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/25645acfde5841c1ab498a665aa6f9a0.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAd2l0dG9u,size_20,color_FFFFFF,t_70,g_se,x_16" />
        </a>
    </p>
<h2 id="2测试docker">2、测试docker</h2>
<h3 id="a准备环境-1">A、准备环境</h3>
<p>这里以一个go语言项目为例，所以需要在gitlab-runner中准备go的编译环境。
如果不使用shell的方式，而是使用docker的方式，在.gitlab-ci.yml中使用image关键指定镜像为golang，就可以跳过此步。</p>
<p>如果使用shell的方式，由于gitlab-runner容器中使用apt或者yum安装的Go版本可能比较老，所以建议自行下载新版的Go，笔者下载的go1.16.11.linux-amd64.tar.gz，然后使用命令复制到gitlab-runner容器中</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>sudo podman cp go1.16.11.linux-amd64.tar.gz gitlab-runner:/usr/local
</span></span></code></pre></div><p>在容器中解压go1.16.11.linux-amd64.tar.gz到/usr/local</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>cd /usr/local
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>tar zxvf go1.16.11.linux-amd64.tar.gz
</span></span></code></pre></div><p>go编译环境还需要安装gcc，前面有说明，这里就不再赘述了。</p>
<h3 id="b准备项目">B、准备项目</h3>
<p>新建一个GoDemo目录，目录中有main.go、Dockerfile和.gitlab-ci.yml三个文件，
main.go内容如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span>	<span style="color:#e6db74">&#34;net/http&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>	<span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">HandleFunc</span>(<span style="color:#e6db74">&#34;/&#34;</span>, <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">writer</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ResponseWriter</span>, <span style="color:#a6e22e">request</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Request</span>) {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>		<span style="color:#a6e22e">writer</span>.<span style="color:#a6e22e">Write</span>([]byte(<span style="color:#e6db74">&#34;Hello, 这是一个CI/CD测试!&#34;</span>))
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>	})
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span>	<span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ListenAndServe</span>(<span style="color:#e6db74">&#34;:8000&#34;</span>, <span style="color:#66d9ef">nil</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span>}
</span></span></code></pre></div><p>Dockerfile内容如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span>FROM ubuntu
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span><span style="color:#75715e"># 镜像中项目路径</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span>WORKDIR $GOPATH/src/GoDemo
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span><span style="color:#75715e"># 拷贝当前目录代码到镜像</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>COPY . $GOPATH/src/GoDemo
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span><span style="color:#75715e"># 暴露端口</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>EXPOSE <span style="color:#ae81ff">8000</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span><span style="color:#75715e"># 程序入口</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span>ENTRYPOINT <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;./bin/demo&#34;</span><span style="color:#f92672">]</span>
</span></span></code></pre></div><p>.gitlab-ci.yml内容如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span><span style="color:#f92672">default</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span>  <span style="color:#f92672">before_script</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span>    - <span style="color:#ae81ff">export PATH=$PATH:/usr/local/go/bin  </span> <span style="color:#75715e"># 添加go命令的路径</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span>    - <span style="color:#ae81ff">export GOPATH=~/go                   </span> <span style="color:#75715e"># 设置GOPATH环境变量</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>    - <span style="color:#ae81ff">mkdir -p $GOPATH/src/                </span> <span style="color:#75715e"># 根据go要求，创建src目录</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>    - <span style="color:#ae81ff">ln -svf $CI_PROJECT_DIR $GOPATH/src/ </span> <span style="color:#75715e"># 由于gitlab-runner的工作目录不在Go要求的目录，所以这里做一个软链接</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>    - <span style="color:#ae81ff">cd $CI_PROJECT_DIR                   </span> <span style="color:#75715e"># 切换到源码目录</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>    - <span style="color:#ae81ff">go mod init demo						# 生成go.mod文件</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>    - <span style="color:#ae81ff">go mod tidy 							# 生成go.sum文件</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>    - <span style="color:#ae81ff">go get								# 下载依赖项</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span>  
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span><span style="color:#f92672">variables</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span>  <span style="color:#75715e">#CI_DEBUG_TRACE: &#34;true&#34;					# 用于CI调试，输出相关的变量值</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span>  <span style="color:#f92672">GO111MODULE</span>: <span style="color:#e6db74">&#34;on&#34;</span>							<span style="color:#75715e"># 打开go的模块标志</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span>  <span style="color:#f92672">GOPROXY</span>: <span style="color:#e6db74">&#34;https://goproxy.cn,direct&#34;</span>      <span style="color:#75715e"># 由于默认的代理很慢，国内建议使用https://goproxy.cn作代理</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span><span><span style="color:#f92672">stages</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span><span>	- <span style="color:#ae81ff">gen</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span><span>    - <span style="color:#ae81ff">test</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span><span>    - <span style="color:#ae81ff">build</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span><span>    - <span style="color:#ae81ff">deploy</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span><span><span style="color:#f92672">format</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span><span>    <span style="color:#f92672">stage</span>: <span style="color:#ae81ff">test</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span><span>    <span style="color:#f92672">tags</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span><span>      - <span style="color:#ae81ff">build</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27</span><span>    <span style="color:#f92672">script</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28</span><span>      - <span style="color:#ae81ff">go fmt $(go list ./... | grep -v /vendor/)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29</span><span>      - <span style="color:#ae81ff">go vet $(go list ./... | grep -v /vendor/)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31</span><span><span style="color:#f92672">test</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32</span><span>    <span style="color:#f92672">stage</span>: <span style="color:#ae81ff">test</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33</span><span>    <span style="color:#f92672">tags</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34</span><span>      - <span style="color:#ae81ff">build</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35</span><span>    <span style="color:#f92672">script</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36</span><span>      - <span style="color:#ae81ff">go test -race $(go list ./... | grep -v /vendor/)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38</span><span><span style="color:#f92672">compile</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39</span><span>    <span style="color:#f92672">stage</span>: <span style="color:#ae81ff">build</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40</span><span>    <span style="color:#f92672">tags</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41</span><span>      - <span style="color:#ae81ff">build</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42</span><span>    <span style="color:#f92672">script</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43</span><span>      - <span style="color:#ae81ff">go build -race -ldflags &#34;-extldflags &#39;-static&#39;&#34; -o $CI_PROJECT_DIR/bin/demo</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44</span><span>    <span style="color:#f92672">artifacts</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45</span><span>      <span style="color:#f92672">paths</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46</span><span>        - <span style="color:#ae81ff">$CI_PROJECT_DIR/bin/</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48</span><span><span style="color:#f92672">docker-deploy</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49</span><span>  <span style="color:#f92672">image</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50</span><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">docker:latest</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51</span><span>  <span style="color:#f92672">stage</span>: <span style="color:#ae81ff">deploy</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52</span><span>  <span style="color:#f92672">before_script</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53</span><span>    <span style="color:#75715e"># 需要先登录gitlab内置的镜像仓库</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54</span><span>    - <span style="color:#ae81ff">docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55</span><span>  <span style="color:#f92672">script</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56</span><span>    <span style="color:#75715e"># 使用Dockerfile生成容器镜像</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57</span><span>    - <span style="color:#ae81ff">docker build --tag $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA --tag $CI_REGISTRY_IMAGE:latest .</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58</span><span>    - <span style="color:#ae81ff">docker push $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA  	# 按SHA推送镜像</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59</span><span>    - <span style="color:#ae81ff">docker push $CI_REGISTRY_IMAGE:latest				# 推送latest镜像</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60</span><span>    - <span style="color:#ae81ff">docker rmi -f $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA  </span> <span style="color:#75715e"># 删除本地临时镜像</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61</span><span>    - <span style="color:#ae81ff">docker rmi -f $CI_REGISTRY_IMAGE:latest			# 删除本地临时镜像</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62</span><span>  <span style="color:#f92672">tags</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63</span><span>    - <span style="color:#ae81ff">docker</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65</span><span><span style="color:#75715e"># 让gitlab具有代码跳转的能力</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66</span><span><span style="color:#f92672">code_navigation</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67</span><span>  <span style="color:#f92672">stage</span>: <span style="color:#ae81ff">gen</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68</span><span>  <span style="color:#f92672">image</span>: <span style="color:#ae81ff">sourcegraph/lsif-go:v1</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69</span><span>  <span style="color:#f92672">allow_failure</span>: <span style="color:#66d9ef">true</span> <span style="color:#75715e"># recommended</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70</span><span>  <span style="color:#f92672">script</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71</span><span>    - <span style="color:#ae81ff">lsif-go -o server.lsif</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72</span><span>  <span style="color:#f92672">artifacts</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73</span><span>    <span style="color:#f92672">reports</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74</span><span>      <span style="color:#f92672">lsif</span>: <span style="color:#ae81ff">server.lsif</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75</span><span>  <span style="color:#f92672">tags</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76</span><span>      - <span style="color:#ae81ff">docker</span>
</span></span></code></pre></div><p>如果是使用golang的docker镜像，则可以不用设置PATH变量，比如compile，可以写为：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span>compile:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span>    image: golang:1.16
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span>    stage: build
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span>    tags:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>      - docker
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>    script:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>      - go version
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>      - go mod init demo
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>      - go mod tidy
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>      - go get
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span>      - go mod vendor
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span>      - go build -race -ldflags <span style="color:#e6db74">&#34;-extldflags &#39;-static&#39;&#34;</span> -o $CI_PROJECT_DIR/bin/demo
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span>    artifacts:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span>      paths:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span>        - $CI_PROJECT_DIR/bin/
</span></span></code></pre></div><h3 id="c测试">C、测试</h3>
<p>笔者的运行流水线如下图所示：</p>
<p>
        <a data-fancybox="gallery" href="https://img-blog.csdnimg.cn/c9cf673d9fc14c3d9d09356ce95c52ed.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAd2l0dG9u,size_20,color_FFFFFF,t_70,g_se,x_16">
            <img class="mx-auto" alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/c9cf673d9fc14c3d9d09356ce95c52ed.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAd2l0dG9u,size_20,color_FFFFFF,t_70,g_se,x_16" />
        </a>
    </p>
<p>容器镜像库如下图所示：</p>
<p>
        <a data-fancybox="gallery" href="https://img-blog.csdnimg.cn/683e17af02744d48828d3a8b346b49b9.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAd2l0dG9u,size_20,color_FFFFFF,t_70,g_se,x_16">
            <img class="mx-auto" alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/683e17af02744d48828d3a8b346b49b9.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAd2l0dG9u,size_20,color_FFFFFF,t_70,g_se,x_16" />
        </a>
    </p>
<p>前面.gitlab-ci.yml中code_navigation让gitlab页面可以进行代码跳转，效果如下图所示：</p>
<p>
        <a data-fancybox="gallery" href="https://img-blog.csdnimg.cn/bb4027fb949846b19e5821fdb818bbdc.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAd2l0dG9u,size_20,color_FFFFFF,t_70,g_se,x_16">
            <img class="mx-auto" alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/bb4027fb949846b19e5821fdb818bbdc.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAd2l0dG9u,size_20,color_FFFFFF,t_70,g_se,x_16" />
        </a>
    </p>
<p>运行前面提交的镜像，注意需要把端口映射出来：</p>
<p>
        <a data-fancybox="gallery" href="https://img-blog.csdnimg.cn/0587faa34df74c3d8cfd2414b1c78b79.png">
            <img class="mx-auto" alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/0587faa34df74c3d8cfd2414b1c78b79.png" />
        </a>
    </p>
<p>查看运行情况：</p>
<p>
        <a data-fancybox="gallery" href="https://img-blog.csdnimg.cn/002d5ee67640472a8e0eb4c7b508906e.png">
            <img class="mx-auto" alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/002d5ee67640472a8e0eb4c7b508906e.png" />
        </a>
    </p>
<p>
        <a data-fancybox="gallery" href="https://img-blog.csdnimg.cn/71a41faf143a47b4ac0a29edeefde04f.png">
            <img class="mx-auto" alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/71a41faf143a47b4ac0a29edeefde04f.png" />
        </a>
    </p>
<p>运行成功。</p>

        </div>









	<ul class="post-nav">
		
			<li class="post-nav-prev">
				<a href="/posts/%E5%AE%B9%E5%99%A8/2021-12-16-%E4%BD%BF%E7%94%A8nexus3%E4%BD%9C%E4%B8%BADocker%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93/" rel="prev">&lt; 使用nexus3作为Docker镜像仓库</a>
			</li>
		
		
			<li class="post-nav-next">
				<a href="/posts/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/2021-08-15-CentOS6.x%E4%B8%8D%E5%8D%87%E7%BA%A7%E5%86%85%E6%A0%B8%E5%AE%89%E8%A3%85Docker/" rel="next">CentOS6.x不升级内核安装Docker &gt;</a>
			</li>
		
	</ul>



<div class="post-archive">
    <ul class="post-copyright">
        <li><strong>原文作者：</strong><a rel="author" href="https://wittonbell.github.io/">Witton</a></li>
        
        
        
        
        <li style="word-break:break-all"><strong>原文链接：</strong><a href="https://wittonbell.github.io/posts/%E5%AE%B9%E5%99%A8/2021-11-30-%E4%BD%BF%E7%94%A8podman%E5%AE%B9%E5%99%A8%E9%85%8D%E7%BD%AEgitlab/">https://wittonbell.github.io/posts/容器/2021-11-30-使用podman容器配置gitlab/</a></li>
        <li><strong>版权声明：</strong>本作品采用<a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/">知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议</a>. 进行许可，非商业转载请注明出处（作者，原文链接），商业转载请联系作者获得授权。</li>
    </ul>
</div>
<br/>




<div class="post-archive">
    <h2>相关文章</h2>
    <ul class="listing">
        
        <li><a href="/posts/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/2021-08-15-CentOS6.x%E4%B8%8D%E5%8D%87%E7%BA%A7%E5%86%85%E6%A0%B8%E5%AE%89%E8%A3%85Docker/">CentOS6.x不升级内核安装Docker</a></li>
        
        <li><a href="/posts/%E5%85%B6%E5%AE%83/2021-08-10-%E4%BD%BF%E7%94%A8jekyll%E5%86%99%E5%8D%9A%E5%AE%A2/">使用jekyll写博客</a></li>
        
        <li><a href="/posts/%E7%BC%96%E7%A8%8B/%E8%AF%AD%E8%A8%80/C&#43;&#43;/2021-07-08-C&#43;&#43;%E5%AE%9E%E7%8E%B0Go%E7%9A%84defer%E5%8A%9F%E8%83%BD/">C&#43;&#43;实现Go的defer功能</a></li>
        
        <li><a href="/posts/%E7%BC%96%E7%A8%8B/%E8%AF%AD%E8%A8%80/Go/2021-03-10-go%E8%AF%BB%E5%86%99%E7%BD%91%E7%BB%9C%E6%B6%88%E6%81%AF/">go读写网络消息</a></li>
        
        <li><a href="/posts/%E7%BC%96%E7%A8%8B/%E8%AF%AD%E8%A8%80/C&#43;&#43;/2021-02-24-%E5%AF%B9C&#43;&#43;%E5%8F%98%E9%95%BF%E5%8F%82%E6%95%B0%E4%B8%AD%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BF%9B%E8%A1%8C%E8%BD%AC%E4%B9%89/">对C&#43;&#43;变长参数中的字符串进行转义</a></li>
        
    </ul>
</div>


<div class="post-meta meta-tags">
            
            <ul class="clearfix">
                
                <li><a href='/tags/%E5%AE%B9%E5%99%A8/' target="_blank">容器</a></li>
                
                <li><a href='/tags/podman/' target="_blank">podman</a></li>
                
                <li><a href='/tags/docker/' target="_blank">docker</a></li>
                
                <li><a href='/tags/gitlab/' target="_blank">gitlab</a></li>
                
                <li><a href='/tags/runner/' target="_blank">runner</a></li>
                
            </ul>
            
        </div>
    </article>
    

    
<div id="gitalk-container"></div>
<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
<script>
    const ID = "2021-11-30-使用podman容器配置gitlab" 
    const Title = "2021-11-30-使用podman容器配置gitlab"
    const gitalk = new Gitalk({
        clientID: '118c70fe27b7246dfb76',
        clientSecret: '7b3780db9b53dacb307bf191a4293374933c7a37',
        repo: 'comment',
        owner: 'WittonBell',
        admin: ['WittonBell'],
        id: ID, 
        title: Title,
        proxy: 'https:\/\/proxy.cors.sh\/https:\/\/github.com\/login\/oauth\/access_token',
        pagerDirection: "last",
        createIssueManually:  false ,
        distractionFreeMode:  false  
    });
    (function () {
        
        
        
        
        gitalk.render('gitalk-container');
    })();
</script>


</div>
<footer id="footer">
    <div>
        &copy; 2006 - 2023 <a href="https://wittonbell.github.io/">Witton的博客 By Witton</a>
        
    </div>
    <br />
    <div>
        <div class="github-badge">
            <a href="https://gohugo.io/" target="_black" rel="nofollow"><span class="badge-subject">Powered by</span><span class="badge-value bg-blue">Hugo</span></a>
        </div>
        <div class="github-badge">
            <a href="https://wittonbell.github.io/" target="_black"><span class="badge-subject">Design by</span><span class="badge-value bg-brightgreen">Witton</span></a>
        </div>
        <div class="github-badge">
            <a href="https://github.com/WittonBell/maupassant-hugo" target="_black"><span class="badge-subject">Theme</span><span class="badge-value bg-yellowgreen">Maupassant</span></a>
        </div>
    </div>
</footer><script src="//cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js"></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>
<style type="text/css">
div.highlight {
    position: relative;
    margin: 1em 0px;
}

.copy-code {
    display: none;
    position: absolute;
    top: 4px;
    right: 4px;
    color: rgba(255, 255, 255, 0.8);
    background: rgba(78, 78, 78, 0.8);
    border-radius: var(--radius);
    padding: 0 5px;
    font: inherit;
    user-select: none;
    cursor: pointer;
    border: 0;
    --radius: 8px;
}

div.highlight:hover .copy-code,pre:hover .copy-code {
    display: block;
}

</style>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = '复制';

        function copyingDone() {
            copybutton.innerHTML = '已复制';
            setTimeout(() => {
                copybutton.innerHTML = '复制';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
<script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>

</div>

            <div id="secondary">
    <section class="widget">
    <form id="search" action='https://wittonbell.github.io/search' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder=搜索>
      <input type="hidden" name="sitesearch" value="https://wittonbell.github.io/">
      <button type="submit" class="submit icon-search" title=搜索></button>
</form>
    </section>

    <section class="widget">
    <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    <li>
        <a href="https://wittonbell.github.io/posts/%E7%BC%96%E7%A8%8B/VS/2023-08-21-VS2022%E8%A7%A3%E5%86%B3Protobuf-compiler-version-23.4-doesnt-match-library-version-4.23.4/" title="VS2022解决Protobuf compiler version 23.4 doesn&#39;t match library version 4.23.4" target="_blank">VS2022解决Protobuf compiler version 23.4 doesn&#39;t match library version 4.23.4</a>
    </li>
    <li>
        <a href="https://wittonbell.github.io/posts/%E7%BC%96%E7%A8%8B/Linux/2023-08-13-%E8%A7%A3%E5%86%B3lldb%E8%B0%83%E8%AF%95%E6%97%B6%E5%8F%AF%E8%83%BD%E5%87%BA%E7%8E%B0%E7%9A%84personality-set-failed-Function-not-implemented/" title="解决lldb调试时可能出现的personality set failed Function not implemented" target="_blank">解决lldb调试时可能出现的personality set failed Function not implemented</a>
    </li>
    <li>
        <a href="https://wittonbell.github.io/posts/%E5%85%B6%E5%AE%83/2022-03-16-%E8%AE%A9docsify-katex%E6%94%AF%E6%8C%81%E5%8C%96%E5%AD%A6%E5%85%AC%E5%BC%8Fmhchem%E6%89%A9%E5%B1%95/" title="让docsify-katex支持化学公式mhchem扩展" target="_blank">让docsify-katex支持化学公式mhchem扩展</a>
    </li>
    <li>
        <a href="https://wittonbell.github.io/posts/%E5%85%B6%E5%AE%83/2022-02-22-%E4%BD%BF%E7%94%A8docsify&#43;markdown&#43;vditor%E6%9E%84%E5%BB%BAgitlab_pages%E6%96%87%E6%A1%A3%E5%BA%93/" title="使用docsify&#43;markdown&#43;vditor构建gitlab pages文档库" target="_blank">使用docsify&#43;markdown&#43;vditor构建gitlab pages文档库</a>
    </li>
    <li>
        <a href="https://wittonbell.github.io/posts/%E5%AE%B9%E5%99%A8/2022-01-11-%E4%BD%BF%E7%94%A8%E5%AE%B9%E5%99%A8%E7%BC%96%E6%8E%92%E5%AF%B9go%E9%A1%B9%E7%9B%AE%E8%BF%9B%E8%A1%8C%E9%83%A8%E7%BD%B2%E8%B0%83%E8%AF%95/" title="使用容器编排对go项目进行部署、调试" target="_blank">使用容器编排对go项目进行部署、调试</a>
    </li>
    <li>
        <a href="https://wittonbell.github.io/posts/%E5%AE%B9%E5%99%A8/2021-12-28-ubuntu%E5%AE%89%E8%A3%85podman-compose/" title="ubuntu安装podman-compose" target="_blank">ubuntu安装podman-compose</a>
    </li>
    <li>
        <a href="https://wittonbell.github.io/posts/%E5%AE%B9%E5%99%A8/2021-12-28-%E8%A7%A3%E5%86%B3podman-failedto_create_new_watcher_too_many_open_files/" title="解决podman failed：to create new watcher too many open files" target="_blank">解决podman failed：to create new watcher too many open files</a>
    </li>
    <li>
        <a href="https://wittonbell.github.io/posts/%E5%AE%B9%E5%99%A8/2021-12-23-Goland%E8%BF%9E%E6%8E%A5https%E7%9A%84Docker%E8%BF%9C%E7%A8%8B%E6%9C%8D%E5%8A%A1/" title="Goland连接https的Docker远程服务" target="_blank">Goland连接https的Docker远程服务</a>
    </li>
    <li>
        <a href="https://wittonbell.github.io/posts/%E5%AE%B9%E5%99%A8/2021-12-21-Goland%E4%BD%BF%E7%94%A8%E8%BF%9C%E7%A8%8B%E5%AE%B9%E5%99%A8%E8%BF%9B%E8%A1%8Cgo%E5%BC%80%E5%8F%91%E8%B0%83%E8%AF%95/" title="Goland使用远程容器进行go开发调试" target="_blank">Goland使用远程容器进行go开发调试</a>
    </li>
    <li>
        <a href="https://wittonbell.github.io/posts/%E5%AE%B9%E5%99%A8/2021-12-16-%E4%BD%BF%E7%94%A8nexus3%E4%BD%9C%E4%B8%BADocker%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93/" title="使用nexus3作为Docker镜像仓库" target="_blank">使用nexus3作为Docker镜像仓库</a>
    </li>
</ul>
</section><section class="widget">
    <h3 class="widget-title"><a href='/categories/'>分类</a></h3>
<ul class="widget-list">
    <li><a href="https://wittonbell.github.io/categories/C/C&#43;&#43;/">C/C&#43;&#43; (31)</a></li>
    <li><a href="https://wittonbell.github.io/categories/Cocos2D/">Cocos2D (1)</a></li>
    <li><a href="https://wittonbell.github.io/categories/Go/">Go (8)</a></li>
    <li><a href="https://wittonbell.github.io/categories/LLVM/">LLVM (3)</a></li>
    <li><a href="https://wittonbell.github.io/categories/Linux/">Linux (13)</a></li>
    <li><a href="https://wittonbell.github.io/categories/Lua/">Lua (5)</a></li>
    <li><a href="https://wittonbell.github.io/categories/MSYS2/">MSYS2 (1)</a></li>
    <li><a href="https://wittonbell.github.io/categories/Python/">Python (2)</a></li>
    <li><a href="https://wittonbell.github.io/categories/VS/">VS (6)</a></li>
    <li><a href="https://wittonbell.github.io/categories/Windows/">Windows (5)</a></li>
    <li><a href="https://wittonbell.github.io/categories/nasm/">nasm (1)</a></li>
    <li><a href="https://wittonbell.github.io/categories/%E5%85%B6%E5%AE%83/">其它 (3)</a></li>
    <li><a href="https://wittonbell.github.io/categories/%E5%AE%B9%E5%99%A8/">容器 (7)</a></li>
    <li><a href="https://wittonbell.github.io/categories/%E6%B8%B8%E6%88%8F/">游戏 (1)</a></li>
    <li><a href="https://wittonbell.github.io/categories/%E7%AE%97%E6%B3%95/">算法 (1)</a></li>
</ul>
</section>

    <section class="widget">
    <h3 class="widget-title"><a href='/tags/'>标签</a></h3>
<div class="tagcloud">
    <a href="https://wittonbell.github.io/tags/.a/">.a</a>
    <a href="https://wittonbell.github.io/tags/C&#43;&#43;/">C&#43;&#43;</a>
    <a href="https://wittonbell.github.io/tags/C/C&#43;&#43;/">C/C&#43;&#43;</a>
    <a href="https://wittonbell.github.io/tags/CNI/">CNI</a>
    <a href="https://wittonbell.github.io/tags/CentOS/">CentOS</a>
    <a href="https://wittonbell.github.io/tags/CentOS-6.x/">CentOS 6.x</a>
    <a href="https://wittonbell.github.io/tags/CheckInstall/">CheckInstall</a>
    <a href="https://wittonbell.github.io/tags/Clang/">Clang</a>
    <a href="https://wittonbell.github.io/tags/Cocos2D/">Cocos2D</a>
    <a href="https://wittonbell.github.io/tags/Cocos2D-X/">Cocos2D-X</a>
    <a href="https://wittonbell.github.io/tags/Crash/">Crash</a>
    <a href="https://wittonbell.github.io/tags/docker/">docker</a>
    <a href="https://wittonbell.github.io/tags/G&#43;&#43;/">G&#43;&#43;</a>
    <a href="https://wittonbell.github.io/tags/GCC/">GCC</a>
    <a href="https://wittonbell.github.io/tags/go/">go</a>
    <a href="https://wittonbell.github.io/tags/Goland/">Goland</a>
    <a href="https://wittonbell.github.io/tags/LLVM/">LLVM</a>
    <a href="https://wittonbell.github.io/tags/Linux/">Linux</a>
    <a href="https://wittonbell.github.io/tags/Lua/">Lua</a>
    <a href="https://wittonbell.github.io/tags/LuaTinker/">LuaTinker</a>
    <a href="https://wittonbell.github.io/tags/Lua%E8%A7%A3%E5%AF%86/">Lua解密</a>
    <a href="https://wittonbell.github.io/tags/MFC/">MFC</a>
    <a href="https://wittonbell.github.io/tags/MinGW/">MinGW</a>
    <a href="https://wittonbell.github.io/tags/PB/">PB</a>
    <a href="https://wittonbell.github.io/tags/protobuf/">protobuf</a>
    <a href="https://wittonbell.github.io/tags/Python/">Python</a>
    <a href="https://wittonbell.github.io/tags/RPM/">RPM</a>
    <a href="https://wittonbell.github.io/tags/SFINAE/">SFINAE</a>
    <a href="https://wittonbell.github.io/tags/SSL/">SSL</a>
    <a href="https://wittonbell.github.io/tags/Samba/">Samba</a>
    <a href="https://wittonbell.github.io/tags/TLS/">TLS</a>
    <a href="https://wittonbell.github.io/tags/Table/">Table</a>
    <a href="https://wittonbell.github.io/tags/Unicode/">Unicode</a>
    <a href="https://wittonbell.github.io/tags/VC/">VC</a>
    <a href="https://wittonbell.github.io/tags/Visual-Studio/">Visual Studio</a>
    <a href="https://wittonbell.github.io/tags/WSL2/">WSL2</a>
    <a href="https://wittonbell.github.io/tags/Windows/">Windows</a>
    <a href="https://wittonbell.github.io/tags/blog/">blog</a>
    <a href="https://wittonbell.github.io/tags/CentOS/">CentOS</a>
    <a href="https://wittonbell.github.io/tags/class/">class</a>
    <a href="https://wittonbell.github.io/tags/cmake/">cmake</a>
    <a href="https://wittonbell.github.io/tags/compiler/">compiler</a>
    <a href="https://wittonbell.github.io/tags/compose/">compose</a>
    <a href="https://wittonbell.github.io/tags/debugger/">debugger</a>
    <a href="https://wittonbell.github.io/tags/defer/">defer</a>
    <a href="https://wittonbell.github.io/tags/dll/">dll</a>
    <a href="https://wittonbell.github.io/tags/docker/">docker</a>
    <a href="https://wittonbell.github.io/tags/docker-compose/">docker-compose</a>
    <a href="https://wittonbell.github.io/tags/docsify/">docsify</a>
    <a href="https://wittonbell.github.io/tags/GCC/">GCC</a>
    <a href="https://wittonbell.github.io/tags/github-pages/">github pages</a>
    <a href="https://wittonbell.github.io/tags/gitlab/">gitlab</a>
    <a href="https://wittonbell.github.io/tags/gitlab-pages/">gitlab pages</a>
    <a href="https://wittonbell.github.io/tags/go/">go</a>
    <a href="https://wittonbell.github.io/tags/jekyll/">jekyll</a>
    <a href="https://wittonbell.github.io/tags/katex/">katex</a>
    <a href="https://wittonbell.github.io/tags/lib/">lib</a>
    <a href="https://wittonbell.github.io/tags/lldb/">lldb</a>
    <a href="https://wittonbell.github.io/tags/markdown/">markdown</a>
    <a href="https://wittonbell.github.io/tags/mhchem/">mhchem</a>
    <a href="https://wittonbell.github.io/tags/nasm/">nasm</a>
    <a href="https://wittonbell.github.io/tags/nexus3/">nexus3</a>
    <a href="https://wittonbell.github.io/tags/pip/">pip</a>
    <a href="https://wittonbell.github.io/tags/podman/">podman</a>
    <a href="https://wittonbell.github.io/tags/podman-compose/">podman-compose</a>
    <a href="https://wittonbell.github.io/tags/protobuf/">protobuf</a>
    <a href="https://wittonbell.github.io/tags/ruby/">ruby</a>
    <a href="https://wittonbell.github.io/tags/runner/">runner</a>
    <a href="https://wittonbell.github.io/tags/ubuntu/">ubuntu</a>
    <a href="https://wittonbell.github.io/tags/VC/">VC</a>
    <a href="https://wittonbell.github.io/tags/vditor/">vditor</a>
    <a href="https://wittonbell.github.io/tags/%E4%BD%8D%E5%9F%9F/">位域</a>
    <a href="https://wittonbell.github.io/tags/%E4%BF%AE%E5%A4%8D/">修复</a>
    <a href="https://wittonbell.github.io/tags/%E5%86%85%E6%A0%B8/">内核</a>
    <a href="https://wittonbell.github.io/tags/%E5%86%85%E8%81%94%E6%B1%87%E7%BC%96/">内联汇编</a>
    <a href="https://wittonbell.github.io/tags/%E5%86%99%E5%8D%9A%E5%AE%A2/">写博客</a>
    <a href="https://wittonbell.github.io/tags/%E5%8A%A8%E6%80%81%E5%BA%93/">动态库</a>
    <a href="https://wittonbell.github.io/tags/%E5%8F%8B%E5%85%83%E5%87%BD%E6%95%B0/">友元函数</a>
    <a href="https://wittonbell.github.io/tags/%E5%8F%98%E9%95%BF%E5%8F%82%E6%95%B0/">变长参数</a>
    <a href="https://wittonbell.github.io/tags/%E5%90%AF%E5%8A%A8/">启动</a>
    <a href="https://wittonbell.github.io/tags/%E5%AD%97%E7%AC%A6%E4%B8%B2/">字符串</a>
    <a href="https://wittonbell.github.io/tags/%E5%AE%89%E8%A3%85%E5%8C%85/">安装包</a>
    <a href="https://wittonbell.github.io/tags/%E5%AE%8F/">宏</a>
    <a href="https://wittonbell.github.io/tags/%E5%AE%B9%E5%99%A8/">容器</a>
    <a href="https://wittonbell.github.io/tags/%E5%BA%8F%E5%88%97%E5%8C%96/">序列化</a>
    <a href="https://wittonbell.github.io/tags/%E6%88%90%E5%91%98%E5%87%BD%E6%95%B0/">成员函数</a>
    <a href="https://wittonbell.github.io/tags/%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88/">智能指针</a>
    <a href="https://wittonbell.github.io/tags/%E6%A8%A1%E6%9D%BF/">模板</a>
    <a href="https://wittonbell.github.io/tags/%E6%B3%A8%E5%86%8C%E8%A1%A8/">注册表</a>
    <a href="https://wittonbell.github.io/tags/%E7%88%AC%E8%99%AB/">爬虫</a>
    <a href="https://wittonbell.github.io/tags/%E7%AE%97%E6%B3%95/">算法</a>
    <a href="https://wittonbell.github.io/tags/%E7%B1%BB/">类</a>
    <a href="https://wittonbell.github.io/tags/%E7%BC%96%E6%8E%92/">编排</a>
    <a href="https://wittonbell.github.io/tags/%E7%BC%96%E8%AF%91/">编译</a>
    <a href="https://wittonbell.github.io/tags/%E7%BD%91%E7%BB%9C/">网络</a>
    <a href="https://wittonbell.github.io/tags/%E8%A1%A8/">表</a>
    <a href="https://wittonbell.github.io/tags/%E8%A7%A3%E5%AF%86/">解密</a>
    <a href="https://wittonbell.github.io/tags/%E8%B0%83%E8%AF%95/">调试</a>
    <a href="https://wittonbell.github.io/tags/%E8%B7%A8%E5%B9%B3%E5%8F%B0/">跨平台</a>
    <a href="https://wittonbell.github.io/tags/%E9%83%A8%E7%BD%B2/">部署</a>
    <a href="https://wittonbell.github.io/tags/%E9%9A%8F%E6%9C%BA%E6%95%B0/">随机数</a>
    <a href="https://wittonbell.github.io/tags/%E9%9D%99%E6%80%81IP/">静态IP</a>
    <a href="https://wittonbell.github.io/tags/%E9%9D%99%E6%80%81%E5%BA%93/">静态库</a>
    <a href="https://wittonbell.github.io/tags/%E9%A2%84%E7%BC%96%E8%AF%91/">预编译</a>
</div>
</section>
<section class="widget">
    <h3 class="widget-title">友情链接</h3>
    <ul class="widget-list">
        <li>
            <a target="_blank" href="https://blog.csdn.net/witton" title="我的CSDN">我的CSDN博客</a>
        </li>
        
    </ul>
</section>

<section class="widget">
        <h3 class="widget-title">其它</h3>
        <ul class="widget-list">
            <li><a href="https://wittonbell.github.io/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
</div>
        </div>
    </div>
</body>

</html>
